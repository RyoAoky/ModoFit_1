<section class="py-16">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-secondary mb-8 text-center" data-aos="fade-up">Completa tu registro</h1>

            <!-- Pasos del formulario -->
            <div class="flex items-center justify-between mb-8" data-aos="fade-up" data-aos-delay="100">
                <div class="flex items-center">
                    <div class="step-indicator active" id="step-indicator-1">
                        <span>1</span>
                    </div>
                    <div class="hidden sm:block ml-2 text-sm font-medium text-secondary">Plan</div>
                </div>
                <div class="step-line" id="step-line-1"></div>
                <div class="flex items-center">
                    <div class="step-indicator" id="step-indicator-2">
                        <span>2</span>
                    </div>
                    <div class="hidden sm:block ml-2 text-sm font-medium" id="step-text-2">Datos personales</div>
                </div>
                <div class="step-line" id="step-line-2"></div>
                <div class="flex items-center">
                    <div class="step-indicator" id="step-indicator-3">
                        <span>3</span>
                    </div>
                    <div class="hidden sm:block ml-2 text-sm font-medium" id="step-text-3">Pago</div>
                </div>
            </div>

            <!-- Formulario -->
            <form method="POST" action="/venta/procesar-pago" id="registroForm" class="bg-white rounded-lg shadow-lg p-8" data-aos="fade-up" data-aos-delay="200">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <input type="hidden" name="precioTotal" id="precioTotalInput" value="49.90">
                <input type="hidden" name="descuentoAplicado" id="descuentoAplicadoInput" value="false">
                <input type="hidden" name="planSeleccionado" id="planSeleccionadoInput" value="modofit">
                
                <!-- Paso 1: Selección de plan -->
                <div class="form-step active" id="step-1">
                    <h2 class="text-2xl font-bold text-secondary mb-6">Nuestro Plan Exclusivo</h2>

                    <div class="max-w-md mx-auto mb-8">
                        <!-- ModoFit -->
                        <div class="border-2 border-primary rounded-lg overflow-hidden">
                            <div class="bg-primary p-6 text-center">
                                <h3 class="text-lg font-bold text-secondary">Membresía ModoFit</h3>
                                <p class="text-secondary text-3xl font-bold my-3">S/. 49.90<span class="text-gray-700 text-sm font-normal">/mes</span></p>
                            </div>
                            <div class="p-6">
                                <ul class="space-y-3 mb-6 text-sm">
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Acceso al gimnasio</li>
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>2 pases gratis mensual para amigos</li>
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Sillón de masajes</li>
                                    <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i>Congelar membresía</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="border-t pt-6 mb-6">
                        <div class="flex justify-between mb-2">
                            <span>Mensualidad:</span>
                            <span id="precio-mensualidad">S/. 49.90</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span>Matrícula:</span>
                            <span>S/. 0.00</span>
                        </div>
                        <div class="flex justify-between mb-2 text-green-600 hidden" id="descuento-row">
                            <span>Descuento:</span>
                            <span>- S/. 20.00</span>
                        </div>
                        <div class="flex justify-between font-bold text-lg pt-2 border-t">
                            <span>Total:</span>
                            <span class="text-primary" id="precio-total">S/. 49.90</span>
                        </div>
                    </div>

                    <div class="mb-6">
                        <div id="descuento-form" class="flex flex-col sm:flex-row gap-2">
                            <input type="text" id="codigo-descuento" placeholder="Código de descuento" class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            <button type="button" id="aplicar-descuento" class="bg-secondary hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                                Aplicar
                            </button>
                        </div>
                        <div id="descuento-aplicado" class="flex flex-col sm:flex-row gap-2 hidden">
                            <div class="flex-1 px-4 py-2 bg-green-50 border border-green-200 rounded-lg text-green-700">
                                Descuento de S/. 20.00 aplicado
                            </div>
                            <button type="button" id="quitar-descuento" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg transition duration-300">
                                Quitar
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 mt-1" id="descuento-hint">Usa el código "MODOFIT20" para obtener S/. 20.00 de descuento</p>
                    </div>

                    <div class="flex justify-between">
                        <a href="/" class="text-secondary hover:text-primary transition duration-300 inline-flex items-center">
                            <i class="fas fa-arrow-left mr-2"></i> Volver
                        </a>
                        <button type="button" id="next-to-step-2" class="bg-primary hover:bg-yellow-400 text-secondary font-bold py-2 px-6 rounded-full transition duration-300">
                            Continuar
                        </button>
                    </div>
                </div>

                <!-- Paso 2: Datos personales -->
                <div class="form-step" id="step-2">
                    <h2 class="text-2xl font-bold text-secondary mb-6">Datos personales</h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div>
                            <label for="nombre" class="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
                            <input type="text" id="nombre" name="nombre" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>

                        <div>
                            <label for="apellido" class="block text-sm font-medium text-gray-700 mb-1">Apellido</label>
                            <input type="text" id="apellido" name="apellido" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>

                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="email" name="email" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                            <p class="error-message hidden" id="email-error">Por favor, ingresa un correo electrónico válido</p>
                        </div>

                        <div>
                            <label for="telefono" class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                            <input type="tel" id="telefono" name="telefono" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>

                        <div>
                            <label for="dni" class="block text-sm font-medium text-gray-700 mb-1">DNI</label>
                            <input type="text" id="dni" name="dni" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>

                        <div>
                            <label for="fecha-nacimiento" class="block text-sm font-medium text-gray-700 mb-1">Fecha de nacimiento</label>
                            <input type="date" id="fecha-nacimiento" name="fechaNacimiento" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>

                        <div>
                            <label for="direccion" class="block text-sm font-medium text-gray-700 mb-1">Dirección</label>
                            <input type="text" id="direccion" name="direccion" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>

                        <div>
                            <label for="ciudad" class="block text-sm font-medium text-gray-700 mb-1">Ciudad</label>
                            <input type="text" id="ciudad" name="ciudad" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Género</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="genero" value="masculino" class="form-radio text-primary" checked>
                                    <span class="ml-2">Masculino</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="genero" value="femenino" class="form-radio text-primary">
                                    <span class="ml-2">Femenino</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button type="button" id="back-to-step-1" class="bg-gray-200 hover:bg-gray-300 text-secondary font-bold py-2 px-6 rounded-full transition duration-300">
                            Atrás
                        </button>
                        <button type="button" id="next-to-step-3" class="bg-primary hover:bg-yellow-400 text-secondary font-bold py-2 px-6 rounded-full transition duration-300">
                            Continuar
                        </button>
                    </div>
                </div>

                <!-- Paso 3: Datos de pago -->
                <div class="form-step" id="step-3">
                    <h2 class="text-2xl font-bold text-secondary mb-6">Datos de pago</h2>

                    <div class="mb-8">
                        <div class="bg-gray-100 p-4 rounded-lg mb-6">
                            <h3 class="font-bold text-secondary mb-2">Resumen de compra</h3>
                            <div class="flex justify-between mb-1">
                                <span id="resumen-plan">Membresía ModoFit</span>
                                <span>S/. 49.90</span>
                            </div>
                            <div class="flex justify-between mb-1">
                                <span>Matrícula</span>
                                <span>S/. 0.00</span>
                            </div>
                            <div class="flex justify-between mb-1 text-green-600 hidden" id="resumen-descuento">
                                <span>Descuento</span>
                                <span>- S/. 20.00</span>
                            </div>
                            <div class="flex justify-between font-bold border-t border-gray-300 pt-2 mt-2">
                                <span>Total</span>
                                <span class="text-primary" id="resumen-total">S/. 49.90</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="md:col-span-2">
                                <label for="numero-tarjeta" class="block text-sm font-medium text-gray-700 mb-1">Número de tarjeta</label>
                                <input type="text" id="numero-tarjeta" name="numeroTarjeta" placeholder="1234 5678 9012 3456" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                            </div>

                            <div class="md:col-span-2">
                                <label for="nombre-tarjeta" class="block text-sm font-medium text-gray-700 mb-1">Nombre en la tarjeta</label>
                                <input type="text" id="nombre-tarjeta" name="nombreTarjeta" placeholder="Juan Pérez" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                            </div>

                            <div>
                                <label for="fecha-expiracion" class="block text-sm font-medium text-gray-700 mb-1">Fecha de expiración</label>
                                <input type="text" id="fecha-expiracion" name="fechaExpiracion" placeholder="MM/AA" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                            </div>

                            <div>
                                <label for="cvv" class="block text-sm font-medium text-gray-700 mb-1">CVV</label>
                                <input type="text" id="cvv" name="cvv" placeholder="123" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                            </div>
                        </div>

                        <div class="flex items-center mb-6">
                            <input type="checkbox" id="terminos" name="terminosAceptados" class="form-checkbox text-primary" required>
                            <label for="terminos" class="ml-2 text-sm text-gray-700">
                                Acepto los <a href="/terminos_y_condiciones" target="_blank" class="text-primary hover:underline">términos y condiciones</a> y la <a href="/politica_privacidad" target="_blank" class="text-primary hover:underline">política de privacidad</a>.
                            </label>
                        </div>
                        <p class="error-message hidden" id="terminos-error">Debes aceptar los términos y condiciones para continuar</p>
                    </div>

                    <div class="flex justify-between">
                        <button type="button" id="back-to-step-2" class="bg-gray-200 hover:bg-gray-300 text-secondary font-bold py-2 px-6 rounded-full transition duration-300">
                            Atrás
                        </button>
                        <button type="submit" id="completar-pago" class="bg-primary hover:bg-yellow-400 text-secondary font-bold py-2 px-6 rounded-full transition duration-300 pulse-animation">
                            Completar pago
                        </button>
                    </div>
                </div>
            </form>

            <!-- Volver al inicio -->
            <div class="mt-8 text-center" data-aos="fade-up" data-aos-delay="300">
                <a href="/" class="text-primary hover:underline">Volver a la página principal</a>
            </div>
        </div>
    </div>
</section>